---
title: 基础知识：HTTP
copyright: true
date: 2019-02-18 19:41:04
tags:
- Java
categories:
- Java
---

## 1. HTTP简介
- HTTP即超文本传输协议(Hyper Text Transfer Protocol)，是用于从万维网(www)服务器传输超文本到本地浏览器的一种传输协议。
- 基于TCP/IP通信协议来传递数据。
- 属于应用层的面向对象的协议。

## 2. HTTP的特点
- **简单快速：**客户端向服务端请求时只需要传送请求方法和路径，常用的请求方法有GET、POST、HEAD，每种方法规定了客户端和服务器联系的类型不同，用户HTTP协议简单，使得HTTP服务器程序规模较小，因此通信速度很快。

- **灵活：**HTTP允许传输任意类型的数据对象，传输中数据类型通过Content-type标记。

- **HTTP 0.9和1.0使用非持续连接：**限制每次连接只处理一个请求，服务器处理完客户端的请求，并收到客户端的应答后，即断开连接。**HTTP 1.1使用持续连接：**不必为每个web对象创建一个新的连接，一个连接可以传送多个对象，采用这种方式可以节省传输时间。

- **无状态：**HTTP协议是无状态协议，无状态是指协议对于事务处理没有记忆能力，缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大，但是同样也保证了服务器的内存，并且不会因为之前给它发送过应答报文而不接受第二次请求。

## 3. HTTP的请求方法
HTTP/1.1协议中共定义了八种方法（有时也叫“动作”）来表明Request-URI指定的资源的不同操作方式：
- **OPTIONS** - 返回服务器针对特定资源所支持的HTTP请求方法，也可以利用向Web服务器发送'*'的请求来测试服务器的功能性。
 
- **HEAD**- 向服务器索要与GET请求相一致的响应，只不过响应体将不会被返回。这一方法可以在不必传输整个响应内容的情况下，就可以获取包含在响应消息头中的元信息。该方法常用于测试超链接的有效性，是否可以访问，以及最近是否更新。

- **GET** - 向特定的资源发出请求。注意：GET方法不应当被用于产生“副作用”的操作中，例如在web app.中。其中一个原因是GET可能会被网络蜘蛛等随意访问。

- **POST** - 向指定资源提交数据进行处理请求（例如提交表单或者上传文件），数据被包含在请求体中。POST请求可能会导致新的资源的建立或已有资源的修改。

- **PUT** - 向指定资源位置上传其最新内容。

- **DELETE** - 请求服务器删除Request-URI所标识的资源。

- **TRACE**- 回显服务器收到的请求，主要用于测试或诊断。

- **CONNECT** - HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。

- **PATCH** - 用来将局部修改应用于某一资源，添加于规范RFC5789。

**注意点：** 
1. 请求的方法名称是区分大小写的；
2. 当某个请求所针对的资源不支持对应的请求方法的时候，服务器应当返回状态码405（Method Not Allowed）；当服务器不认识或者不支持对应的请求方法的时候，应当返回状态码501（Not Implemented）；
3. HTTP服务器至少应该实现GET和HEAD方法，其他方法都是可选的。此外，除了上述方法，特定的HTTP服务器还能够扩展自定义的方法。


## 4. HTTP的请求步骤
HTTP协议定义Web客户端如何从Web服务器请求Web页面，以及服务器如何把Web页面传送给客户端。HTTP协议采用了请求/响应模型。客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头部和请求数据。服务器以一个状态行作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头部和响应数据。

#### 1. HTTP 请求/响应的步骤

**(1)、客户端连接到Web服务器** 
一个HTTP客户端，通常是浏览器，与Web服务器的HTTP端口（默认为80）建立一个TCP套接字连接。例如，HTTP://www.oakcms.cn。
 
**(2)、发送HTTP请求** 
通过TCP套接字，客户端向Web服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据4部分组成。

**(3)、服务器接受请求并返回HTTP响应** 
Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据4部分组成。

**(4)、释放连接TCP连接** 
若connection 模式为close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放TCP连接;若connection模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;

**(5)、客户端浏览器解析HTML内容** 
客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。

**例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：**
1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;
3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;
4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5、释放 TCP连接;
6、浏览器将该 html 文本并显示内容;

#### 2. 请求头与响应体
**(1)、GET请求**
```java
//---请求行
GET /mHTTP/login/?name=hp HTTP/1.1	//请求方法  请求URL(客户端所说的接口) HTTP协议版本号
//---请求头
Host: passport-api.sdk.mgame.com	//请求的域名
Content-Type: application/json		//请求对象的类型
Accept: application/json
Authentication: Code xxxxxxxxxxxxxxx

//注意这里一定也有一个空行
```

**(2)、POST请求**
```java
//---请求行
POST /mHTTP/auth/register HTTP/1.1		//请求方法  请求URL(客户端所说的接口) HTTP协议版本号
//---请求头
Host: passport-api.sdk.game.com		//请求的域名
Content-Type: application/json		//请求对象的类型
Accept: application/json
                               
//post请求这里一定有个空行
channel_id=1&type=auth&channel_login=1		//---请求数据
```

**(3)、响应体**
```java
//状态行
HTTP/1.1 200 OK
//以下都是消息报头
X-SDK-Server: passport-api
Content-Type: application/json
Content-Length: 10

//消息报头和响应正文(下方是响应正文)之间也一定有个空行
{
  "account": {
    "uid": 123,
    "account": "test",
    "view_name": "test",
    "type": 1,
    "mobile":"13000000000"
  }
}
```
**响应体图示**
![](https://i.imgur.com/pzhNpxi.png)

#### 3. POST与GET的区别

**(1). 请求参数**
- **GET提交时**请求数据会附在URL之后(就是把数据放在HTTP协议头中)，并以?分割URL与数据，多个参数使用&连接。 例如：login?name=hp&passwoed=09987。如果数据是英文字母、数字则原样发送，如果是中文或其他字符，则把字符串用BASE64加密，得到如：%E4%BD%A0%E5%A5%BD的，其中％XX中的XX为该符号以16进制表示的ASCII。
- **POST提交时**提交数据会放在HTTP的包体中(比如上面的POST请求示例)。
 
**(2). 传输数据的大小**
**首先明确的是：HTTP协议并没有对传输数据的大小进行限制，HTTP协议规范也没有对URL的长度进行限制。**
实际开发中的主要限制在于：
- **GET**：特定浏览器和服务器对URL长度有限制，例如 IE对URL长度的限制是2083字节(2K+35)。对于其他浏览器，如Netscape、FireFox等，理论上没有长度限制，其限制取决于操作系 统的支持。因此对于GET提交时，传输数据就会受到URL长度的 限制。
- **POST**：由于不是通过URL传值，理论上数据不受 限。但实际各个WEB服务器会规定对post提交数据大小进行限制，Apache、IIS6都有各自的配置。

**(3). 安全性**
**POST的安全性要比GET的安全性高。**
- 因为通过GET提交数据，用户名和密码将明文出现在URL上，然后登录页面有可能被浏览器缓存，其他人查看浏览器的历史纪录，那么别人就可以拿到你的账号和密码了；
- 除此之外，使用GET提交数据还可能会造成Cross-site request forgery攻击。



